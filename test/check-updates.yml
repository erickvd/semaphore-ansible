- name: Check for available updates on Debian-based systems
  hosts: "{{ HOSTS | default([]) }}"
  become: true
  tasks:
    - name: Update package cache
      ansible.builtin.apt:
        update_cache: true
      changed_when: false

    - name: Check for upgrades
      ansible.builtin.apt:
        upgrade: safe
      register: upgrade_check
      check_mode: true
      changed_when: false

    - name: List available updates
      ansible.builtin.shell: apt list --upgradable 2>/dev/null
      register: upgradable_packages
      changed_when: false

    - name: Display upgradable packages
      ansible.builtin.debug:
        msg: "{{ upgradable_packages.stdout_lines }}"
      when: "'upgradable' in upgradable_packages.stdout"
