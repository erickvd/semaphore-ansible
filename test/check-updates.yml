- name: Check for available updates on Debian-based systems
  hosts: all
  become: yes
  tasks:
    - name: Update package cache
      apt:
        update_cache: yes
      changed_when: false

    - name: Check for upgrades
      apt:
        upgrade: safe
      register: upgrade_check
      check_mode: yes
      changed_when: false

    - name: List available updates
      shell: apt list --upgradable 2>/dev/null
      register: upgradable_packages
      changed_when: false

    - name: Display upgradable packages
      debug:
        msg: "{{ upgradable_packages.stdout_lines }}"
      when: "'upgradable' in upgradable_packages.stdout"
